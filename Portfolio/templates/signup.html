{% extends "base_template.html" %} {% block title %}Sign Up{% endblock %} {%
block content %}

<div class="centered-div">
  <form class="login-div" method="post" action="{{ url_for('signup') }}">
    <img
      draggable="false"
      class="mb-2"
      src="../static/assets/Transparent_NollvaPM_Logo.png"
      alt=""
      width="100"
      height="100"
    />
    <h1 class="h3 mb-3 fw-normal">Create an Account</h1>

    {% if error %}
    <div class="alert alert-danger text-center" role="alert">
      <strong>Error:</strong> {{ error }}
    </div>
    {% endif %}

    <div class="form-floating">
      <input
        type="username"
        class="form-control"
        id="floatingInput"
        name="username"
        placeholder="name@example.com"
        required
      />
      <label for="floatingInput">Username</label>
    </div>
    <div class="form-floating my-3">
      <input
        type="password"
        class="form-control"
        id="password_1"
        name="password1"
        placeholder="Password"
        required
        onkeyup="checkPasswordMatch();"
      />
      <label for="password_1">Password</label>
    </div>

    <div class="form-floating my-3">
      <input
        type="password"
        class="form-control"
        id="password_2"
        name="password2"
        placeholder="Confirm Password"
        required
        onkeyup="checkPasswordMatch();"
      />
      <label for="password_2">Confirm Password</label>
    </div>

    <span
      id="password_message"
      class="text-danger small fw-bold mb-3 d-block"
    ></span>

    <button class="btn btn-primary w-100 py-2" type="submit">Sign Up</button>
  </form>

  <p class="mt-4 text-center">
    Already have an account?
    <a href="/login" class="text-decoration-none">Login</a>
  </p>
</div>

<script>
  function checkPasswordMatch() {
    // FIX: Use the new unique IDs
    var password = document.getElementById("password_1").value;
    var confirmPassword = document.getElementById("password_2").value;
    var messageElement = document.getElementById("password_message");
    var submitButton = document.querySelector('button[type="submit"]');

    messageElement.innerHTML = "";

    // ... (rest of the logic is correct) ...

    if (password.length > 0 && confirmPassword.length > 0) {
      if (password !== confirmPassword) {
        // Passwords do NOT match
        messageElement.innerHTML = "Passwords do not match.";
        messageElement.classList.remove("text-success");
        messageElement.classList.add("text-danger");
        submitButton.disabled = true; // Disable submission
      } else {
        // Passwords DO match
        messageElement.innerHTML = "Passwords match!";
        messageElement.classList.remove("text-danger");
        messageElement.classList.add("text-success");
        submitButton.disabled = false; // Enable submission
      }
    } else {
      // Keep button disabled if fields are empty
      submitButton.disabled = true;
    }
  }
</script>
{% endblock %}
